<!doctype html><html lang="en"><head><meta charset="utf8"><title>Argdown Document</title><link rel="stylesheet" href="./argdown.css"></head><body><div class="argdown"><h2 data-line="1" id="heading-subgroup-operations" class="has-line heading"><span class="statement-content">Subgroup Operations</span></h2><div data-line="9" class="statement has-line top-level"><span id="statement-motivation" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Motivation</span>]: </span><span class="statement-content top-level">We should have subgroup operations.</span><div class="relations"><div data-line="10" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="10" class="argument has-line"><a id="argument-standard-library" href="#argument-standard-library" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Standard Library</span>&gt;: </a><span class="statement-content">Common across all three APIs, see <a href="https://github.com/gpuweb/gpuweb/issues/667">#667</a>, <a href="https://github.com/gpuweb/gpuweb/issues/78">#78</a>, and <a href="https://github.com/gpuweb/WSL/issues/5">WSL#5</a>.</span></div></div><div data-line="14" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="14" class="argument has-line"><a id="argument-performance" href="#argument-performance" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Performance</span>&gt;: </a><span class="statement-content">Proven contribution to general purpose algorithms to make them run <a href="https://developer.nvidia.com/blog/cuda-pro-tip-optimized-filtering-warp-aggregated-atomics/">multiple times</a> faster.</span></div></div><div data-line="17" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="17" class="argument has-line"><a id="argument-viable" href="#argument-viable" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Viable</span>&gt;: </a><span class="statement-content">There is a safe subset of subgroup operations.</span></div></div><div data-line="18" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="18" class="statement has-line"><a href="#statement-extension" class="reference statement-reference">[<span class="title statement-title">Extension</span>] </a></div></div><div data-line="19" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="19" class="statement has-line"><a href="#statement-shuffle-operations" class="reference statement-reference">[<span class="title statement-title">Shuffle Operations</span>] </a></div></div><div data-line="20" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="20" class="statement has-line"><a href="#statement-quad-operations" class="reference statement-reference">[<span class="title statement-title">Quad Operations</span>] </a></div></div><div data-line="21" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="21" class="statement has-line"><a href="#statement-explicit-operations" class="reference statement-reference">[<span class="title statement-title">Explicit Operations</span>] </a></div></div></div></div><div data-line="24" class="statement has-line top-level"><span id="statement-extension" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Extension</span>]: </span><span class="statement-content top-level">Subgroup operations should be exposed as an extension.</span><div class="relations"><div data-line="25" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="25" class="argument has-line"><a id="argument-target" href="#argument-target" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Target</span>&gt;: </a><span class="statement-content">Subgroup operations are not available on all WebGPU target hardware.</span></div></div></div></div><div data-line="28" class="statement has-line top-level"><span id="statement-host-interface" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Host Interface</span>]: </span><span class="statement-content top-level">Subgroup size control and properties should be exposed to the host API.</span><div class="relations"><div data-line="30" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="30" class="argument has-line"><a id="argument-pipeline-properties" href="#argument-pipeline-properties" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Pipeline Properties</span>&gt;: </a><span class="statement-content">Exact subgroup size can't be queried in DirectX 12.</span></div></div><div data-line="31" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="31" class="argument has-line"><a id="argument-size-control" href="#argument-size-control" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Size Control</span>&gt;: </a><span class="statement-content">Only possible for Vulkan with <a href="https://www.khronos.org/registry/vulkan/specs/1.2-extensions/man/html/VK_EXT_subgroup_size_control.html">VK_EXT_subgroup_size_control</a>.</span></div></div></div></div><div data-line="35" class="statement has-line top-level"><span id="statement-compute-only" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Compute Only</span>]: </span><span class="statement-content top-level">Subgroup operations should only work in compute kernels.</span><div class="relations"><div data-line="36" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="36" class="argument has-line"><a id="argument-hardware" href="#argument-hardware" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Hardware</span>&gt;: </a><span class="statement-content">Restricting to compute only increases market (e.g., Adreno).</span></div></div><div data-line="37" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="37" class="argument has-line"><a id="argument-definition" href="#argument-definition" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Definition</span>&gt;: </a><span class="statement-content">Operations are better defined for compute. And this makes concern of helper invocations irrelevant.</span><div class="relations"><div data-line="39" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="39" class="argument has-line"><a id="" href="#argument-viable" data-line="39" class="has-line reference argument-reference">&lt;<span class="title argument-title">Viable</span>&gt; </a></div></div></div></div></div></div></div><div data-line="41" class="statement has-line top-level"><span id="statement-shuffle-operations" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Shuffle Operations</span>]: </span><span class="statement-content top-level">There should be shuffle and relative shuffle operations.</span><div class="relations"><div data-line="42" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="42" class="argument has-line"><a id="argument-directx-12" href="#argument-directx-12" class="definition argument-definition definiendum">&lt;<span class="title argument-title">DirectX 12</span>&gt;: </a><span class="statement-content">DirectX 12 doesn't have shuffle operations.</span></div></div><div data-line="43" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="43" class="argument has-line"><a id="argument-narrow-support" href="#argument-narrow-support" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Narrow Support</span>&gt;: </a><span class="statement-content">Not having shuffle operations increases support (e.g., ARM).</span></div></div></div></div><div data-line="46" class="statement has-line top-level"><span id="statement-quad-operations" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Quad Operations</span>]: </span><span class="statement-content top-level">Quad operations should be their own extension.</span><div class="relations"><div data-line="47" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="47" class="argument has-line"><a id="argument-varying-support" href="#argument-varying-support" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Varying Support</span>&gt;: </a><span class="statement-content">Not ubiquitously supported (e.g., PowerVR).</span></div></div><div data-line="48" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="48" class="argument has-line"><a id="argument-quadgroup-extension" href="#argument-quadgroup-extension" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Quadgroup Extension</span>&gt;: </a><span class="statement-content">If quad operations are made into their own extension, both its potential market becomes larger and subgroup operations' market grows.</span></div></div></div></div><div data-line="52" class="statement has-line top-level"><span id="statement-explicit-operations" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Explicit Operations</span>]: </span><span class="statement-content top-level">Operations that take in active mask or lane index should exist.</span><div class="relations"><div data-line="54" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="54" class="argument has-line"><a id="argument-undefined-behavior" href="#argument-undefined-behavior" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Undefined Behavior</span>&gt;: </a><span class="statement-content">Explicit operations such as broadcasting with index depends on successful query of active lanes which can't be guaranteed with targeted underlying APIs.</span></div></div><div data-line="58" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="58" class="argument has-line"><a id="argument-avoiding-helps" href="#argument-avoiding-helps" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Avoiding Helps</span>&gt;: </a><span class="statement-content">Implicitly active operations are useful enough while making concerns of divergence or reconvergence irrelevant.</span><div class="relations"><div data-line="61" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="61" class="argument has-line"><a id="" href="#argument-viable" data-line="61" class="has-line reference argument-reference">&lt;<span class="title argument-title">Viable</span>&gt; </a></div></div></div></div></div></div></div><div data-line="63" class="statement has-line top-level"><span id="statement-non-uniform" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Non-Uniform</span>]: </span><span class="statement-content top-level">We should support the non-uniform subgroup model.</span><div class="relations"><div data-line="64" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="64" class="argument has-line"><a id="argument-ubiquitous" href="#argument-ubiquitous" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Ubiquitous</span>&gt;: </a><span class="statement-content">All WebGPU target APIs use non-uniform model.</span></div></div><div data-line="65" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="65" class="argument has-line"><a id="argument-ambiguous-divergence" href="#argument-ambiguous-divergence" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Ambiguous Divergence</span>&gt;: </a><span class="statement-content">when invocations in a subgroup are executing &quot;together&quot;, how long is that guaranteed?</span></div></div><div data-line="66" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="66" class="argument has-line"><a id="argument-ambiguous-reconvergence" href="#argument-ambiguous-reconvergence" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Ambiguous Reconvergence</span>&gt;: </a><span class="statement-content">once invocations diverge, what are the guarantees about where you reconverge?</span><div class="relations"><div data-line="67" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="67" class="statement has-line"><span class="statement-content">Vulkan has weak guarantees, D3D12 and Metal don't have anything.</span></div></div><div data-line="68" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="68" class="statement has-line"><span class="statement-content">we can just say invocations never reconverge, which matches AMD ISA and CUDA models.</span></div></div></div></div></div><div data-line="69" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="69" class="argument has-line"><a id="argument-ambiguous-forward-progress" href="#argument-ambiguous-forward-progress" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Ambiguous Forward Progress</span>&gt;: </a><span class="statement-content">how blocks affect progress of other blocks, and invocations within blocks affect progress on other invocations?</span><div class="relations"><div data-line="70" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="70" class="statement has-line"><span class="statement-content">D3D, Metal, and Vulkan are silent on both of these.</span></div></div></div></div></div><div data-line="71" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="71" class="argument has-line"><a id="argument-ambiguous-helpers" href="#argument-ambiguous-helpers" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Ambiguous Helpers</span>&gt;: </a><span class="statement-content">do helper invocations participate in subgroup operations?</span></div></div></div></div></div></body></html>