<!doctype html><html lang="en"><head><meta charset="utf8"><title>Argdown Document</title><link rel="stylesheet" href="./argdown.css"></head><body><div class="argdown"><h2 data-line="1" id="heading-multiple-gpu-queues" class="has-line heading"><span class="statement-content">Multiple GPU Queues</span></h2><div data-line="9" class="statement has-line top-level"><span id="statement-expose-api" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Expose API</span>]: </span><span class="statement-content top-level">We should expose multiple queues with different capabilities.</span><div class="relations"><div data-line="10" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="10" class="argument has-line"><a id="argument-api-support" href="#argument-api-support" class="definition argument-definition definiendum">&lt;<span class="title argument-title">API Support</span>&gt;: </a><span class="statement-content">Common across all three APIs (Metal starting with version 2, where `MTLEvent` got introduced).</span></div></div><div data-line="12" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="12" class="argument has-line"><a id="argument-performance" href="#argument-performance" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Performance</span>&gt;: </a><span class="statement-content">Async compute and transfers are established best practices on the last-gen console hardware (PS4 and XB1). See <a href="https://gpuopen.com/wp-content/uploads/2017/03/GDC2017-Asynchronous-Compute-Deep-Dive.pdf">AMD presentation</a>.</span></div></div><div data-line="15" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="15" class="argument has-line"><a id="argument-viable" href="#argument-viable" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Viable</span>&gt;: </a><span class="statement-content">Investigation showed that we can safely track the ownership of resources by the queues, and insert the necessary pipeline barriers, making this safe.</span></div></div><div data-line="17" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="17" class="statement has-line"><a href="#statement-implicit-transitions" class="reference statement-reference">[<span class="title statement-title">Implicit Transitions</span>] </a></div></div><div data-line="18" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="18" class="statement has-line"><a href="#statement-required-transitions" class="reference statement-reference">[<span class="title statement-title">Required Transitions</span>] </a></div></div></div></div><div data-line="20" class="statement has-line top-level"><span id="statement-fully-internal" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Fully Internal</span>]: </span><span class="statement-content top-level">WebGPU should internally use multiple queues but not necessarily expose them to the user.</span><div class="relations"><div data-line="22" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="22" class="argument has-line"><a id="argument-simple" href="#argument-simple" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Simple</span>&gt;: </a><span class="statement-content">Simplest to use.</span></div></div><div data-line="23" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="23" class="argument has-line"><a id="argument-ineffective" href="#argument-ineffective" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Ineffective</span>&gt;: </a><span class="statement-content">WebGPU doesn't know resource dependencies ahead of time, so finding the efficient scheduling route is hard. It's likely to synchronize more than necessary.</span></div></div><div data-line="26" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="26" class="argument has-line"><a id="argument-metal" href="#argument-metal" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Metal</span>&gt;: </a><span class="statement-content">this is what Metal-1 does in the drivers/run-time.</span></div></div><div data-line="27" class="has-line incoming attack relation"><div class="incoming attack relation-symbol"><span>-&gt;</span></div><div data-line="27" class="statement has-line"><a href="#statement-expose-api" class="reference statement-reference">[<span class="title statement-title">Expose API</span>] </a></div></div></div></div><div data-line="29" class="statement has-line top-level"><span id="statement-implicit-transitions" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Implicit Transitions</span>]: </span><span class="statement-content top-level">Ownership transition can happen automatically, based on resources that are used by submissions.</span><div class="relations"><div data-line="31" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="31" class="argument has-line"><a id="argument-easy" href="#argument-easy" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Easy</span>&gt;: </a><span class="statement-content">Code will always work, just not always be concurrent on GPU, even if the developer submits work to different queues.</span></div></div><div data-line="33" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="33" class="statement has-line"><a href="#statement-webgpu-doesnt-need-fences" class="reference statement-reference">[<span class="title statement-title">WebGPU doesn't need fences</span>] </a></div></div></div></div><div data-line="35" class="statement has-line top-level"><span id="statement-webgpu-doesnt-need-fences" class="definition statement-definition definiendum top-level">[<span class="title statement-title">WebGPU doesn't need fences</span>]: </span><span class="statement-content top-level">Fences are technically not needed in the API and can be removed?</span></div><div data-line="37" class="statement has-line top-level"><span id="statement-optional-transitions" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Optional Transitions</span>]: </span><span class="statement-content top-level">Allow the developer to specify an ownership transition ahead of time.</span><div class="relations"><div data-line="38" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="38" class="statement has-line"><a href="#statement-implicit-transitions" class="reference statement-reference">[<span class="title statement-title">Implicit Transitions</span>] </a></div></div></div></div><div data-line="40" class="statement has-line top-level"><span id="statement-required-transitions" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Required Transitions</span>]: </span><span class="statement-content top-level">Require the developer to transition ownership explicitly.</span><div class="relations"><div data-line="41" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="41" class="argument has-line"><a id="argument-explicit" href="#argument-explicit" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Explicit</span>&gt;: </a><span class="statement-content">Allows the developer to reason about concurrent GPU processing. Since the developers are not required to use the multiple queues, they want to be sure it works as expected if they do use it.</span></div></div><div data-line="44" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="44" class="argument has-line"><a id="argument-racy" href="#argument-racy" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Racy</span>&gt;: </a><span class="statement-content">Changing the order of submissions may result in a synchronization error. If submissions are triggered by external events (e.g. touch), this may be a hidden even race and a footgun in an otherwise correct application.</span><div class="relations"><div data-line="47" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="47" class="argument has-line"><a id="argument-logic" href="#argument-logic" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Logic</span>&gt;: </a><span class="statement-content">If the order of submission is unexpected, that would likely end up with incorrect rendering anyway. So maybe it's fine to disallow that?</span></div></div></div></div></div><div data-line="49" class="has-line incoming attack relation"><div class="incoming attack relation-symbol"><span>-&gt;</span></div><div data-line="49" class="statement has-line"><a href="#statement-optional-transitions" class="reference statement-reference">[<span class="title statement-title">Optional Transitions</span>] </a></div></div></div></div><div data-line="51" class="argument has-line top-level"><a id="argument-skip-submit" href="#argument-skip-submit" class="definition argument-definition definiendum top-level">&lt;<span class="title argument-title">Skip Submit</span>&gt;: </a><span class="statement-content top-level">on Vulkan, we can avoid submitting an empty command buffer with the semaphore and a pipeline barrier.</span><div class="relations"><div data-line="53" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="53" class="statement has-line"><a href="#statement-optional-transitions" class="reference statement-reference">[<span class="title statement-title">Optional Transitions</span>] </a></div></div><div data-line="54" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="54" class="statement has-line"><a href="#statement-required-transitions" class="reference statement-reference">[<span class="title statement-title">Required Transitions</span>] </a></div></div></div></div><div data-line="56" class="statement has-line top-level"><span id="statement-concurrent-textures" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Concurrent Textures</span>]: </span><span class="statement-content top-level">We should support textures that are used concurrently on multiple queues.</span><div class="relations"><div data-line="57" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="57" class="argument has-line"><a id="argument-texture-support" href="#argument-texture-support" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Texture Support</span>&gt;: </a><span class="statement-content">At least D3D12 and Vulkan have explicit opt-in for this behavior.</span></div></div><div data-line="58" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="58" class="argument has-line"><a id="argument-cost" href="#argument-cost" class="definition argument-definition definiendum">&lt;<span class="title argument-title">Cost</span>&gt;: </a><span class="statement-content">There are clear pefromance costs for having this ability on a texture. It's not able to use specific texture states and layouts, and can't use color compression.</span></div></div></div></div></div></body></html>