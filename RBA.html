<!doctype html><html lang="en"><head><meta charset="utf8"><title>Argdown Document</title><link rel="stylesheet" href="./argdown.css"></head><body><div class="argdown"><h2 data-line="1" id="heading-robust-buffer-access" class="has-line heading"><span class="statement-content">Robust Buffer Access</span></h2><div data-line="7" class="statement has-line top-level"><span id="statement-vulkan-rba" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Vulkan-RBA</span>]: </span><span class="statement-content top-level">We should always enable RBA on Vulkan.</span><div class="relations"><div data-line="8" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="8" class="argument has-line"><a id="argument-future-compat" href="#argument-future-compat" class="definition argument-definition definiendum">&lt;<span class="title argument-title">future-compat</span>&gt;: </a><span class="statement-content">we can tighten the requirements to be more portable later</span></div></div></div></div><div data-line="10" class="statement has-line top-level"><span id="statement-rba-non-portable" class="definition statement-definition definiendum top-level">[<span class="title statement-title">RBA-non-portable</span>]: </span><span class="statement-content top-level">Vulkan's RBA guarantees are too weak. Exposing it to the Web could hurt the portability of the API and applications.</span><div class="relations"><div data-line="12" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="12" class="argument has-line"><a id="argument-writes" href="#argument-writes" class="definition argument-definition definiendum">&lt;<span class="title argument-title">writes</span>&gt;: </a><span class="statement-content">OOB writes can be redirected to a random location within the resource, not necessarily discarded</span></div></div><div data-line="13" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="13" class="argument has-line"><a id="argument-reads" href="#argument-reads" class="definition argument-definition definiendum">&lt;<span class="title argument-title">reads</span>&gt;: </a><span class="statement-content">OOB reads can return one of many different values, or any value within the resource</span></div></div><div data-line="14" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="14" class="argument has-line"><a id="argument-atomics" href="#argument-atomics" class="definition argument-definition definiendum">&lt;<span class="title argument-title">atomics</span>&gt;: </a><span class="statement-content">OOB atomics return totally undefined values</span></div></div><div data-line="15" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="15" class="argument has-line"><a id="argument-range" href="#argument-range" class="definition argument-definition definiendum">&lt;<span class="title argument-title">range</span>&gt;: </a><span class="statement-content">resource binding range is not respected</span></div></div><div data-line="16" class="has-line incoming attack relation"><div class="incoming attack relation-symbol"><span>-&gt;</span></div><div data-line="16" class="statement has-line"><a href="#statement-vulkan-rba" class="reference statement-reference">[<span class="title statement-title">Vulkan-RBA</span>] </a></div></div></div></div><div data-line="18" class="argument has-line top-level"><a id="" href="#argument-hyrums-law" class="definition argument-definition definiendum top-level">&lt;<span class="title argument-title">Hyrum's Law</span>&gt;: </a><span class="statement-content top-level">With a sufficient number of users of an API, it does not matter what you promise in the contract: all observable behaviors of your system will be depended on by somebody.</span></div><div id="argument-hyrums-law" data-line="23" class="pcs has-line"><div data-line="23" class="has-line premise pcs-statement"><div class="statement-nr">(<span>1</span>)</div><div data-line="23" class="statement has-line"><span class="statement-content">Developer makes an application that writes a word outside of a storage buffer bounds, and ships it widely.</span></div></div><div data-line="25" class="has-line premise pcs-statement"><div class="statement-nr">(<span>2</span>)</div><div data-line="25" class="statement has-line"><span class="statement-content">The application works well on all Metal, D3D12, and most Vulkan platforms, where the write simply gets discarded. However, developer receives bugs about some Vulkan platforms corrupting the data occasionally, producing incorrect and unexpected results.</span></div></div><div data-line="29" class="has-line inference"><span class="inference-rules"></div><div data-line="30" class="has-line main-conclusion pcs-statement"><div class="statement-nr">(<span>3</span>)</div><div data-line="30" class="statement has-line"><span class="statement-content">Developer and the application community blame Vulkan and WebGPU implementations.</span><div class="relations"><div data-line="31" class="has-line incoming support relation"><div class="incoming support relation-symbol"><span>+&gt;</span></div><div data-line="31" class="statement has-line"><a href="#statement-rba-non-portable" class="reference statement-reference">[<span class="title statement-title">RBA-non-portable</span>] </a></div></div></div></div></div></div><div data-line="33" class="statement has-line top-level"><span id="statement-vulkan-rba2-opt" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Vulkan-RBA2-opt</span>]: </span><span class="statement-content top-level">We should only use <a href="https://www.khronos.org/registry/vulkan/specs/1.2-extensions/man/html/VK_EXT_robustness2.html">VK_EXT_robustness2</a> where available, and have a fallback otherwise.</span><div class="relations"><div data-line="34" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="34" class="argument has-line"><a id="argument-availability" href="#argument-availability" class="definition argument-definition definiendum">&lt;<span class="title argument-title">availability</span>&gt;: </a><span class="statement-content">it's not available everywhere</span></div></div><div data-line="35" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="35" class="argument has-line"><a id="argument-consistency" href="#argument-consistency" class="definition argument-definition definiendum">&lt;<span class="title argument-title">consistency</span>&gt;: </a><span class="statement-content">it provides the same guarantees as D3D12, and what we are going to do on Metal, which are much more portable.</span></div></div></div></div><div data-line="37" class="statement has-line top-level"><span id="statement-emulation-cost" class="definition statement-definition definiendum top-level">[<span class="title statement-title">Emulation-cost</span>]: </span><span class="statement-content top-level">Emulating RBA on Vulkan is expensive.</span><div class="relations"><div data-line="38" class="has-line outgoing support relation"><div class="outgoing support relation-symbol"><span>+</span></div><div data-line="38" class="argument has-line"><a id="argument-extra-descriptor-set" href="#argument-extra-descriptor-set" class="definition argument-definition definiendum">&lt;<span class="title argument-title">extra descriptor set</span>&gt;: </a><span class="statement-content">in order to do vertex pulling, we'd need another descriptor set, and this can be needed on devices that already have only 4 descriptor sets max.</span></div></div><div data-line="40" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="40" class="argument has-line"><a id="argument-non-free" href="#argument-non-free" class="definition argument-definition definiendum">&lt;<span class="title argument-title">non-free</span>&gt;: </a><span class="statement-content">RBA feature is not free either, and the cost may very between platforms.</span></div></div><div data-line="41" class="has-line outgoing attack relation"><div class="outgoing attack relation-symbol"><span>-</span></div><div data-line="41" class="argument has-line"><a id="argument-min-size" href="#argument-min-size" class="definition argument-definition definiendum">&lt;<span class="title argument-title">min-size</span>&gt;: </a><span class="statement-content">we don't need to do anything for the structured part of buffers, since it's covered by <a href="https://github.com/gpuweb/gpuweb/pull/678">minBufferBindingSize</a>.</span></div></div><div data-line="42" class="has-line incoming attack relation"><div class="incoming attack relation-symbol"><span>-&gt;</span></div><div data-line="42" class="statement has-line"><a href="#statement-vulkan-rba2-opt" class="reference statement-reference">[<span class="title statement-title">Vulkan-RBA2-opt</span>] </a></div></div></div></div></div></body></html>